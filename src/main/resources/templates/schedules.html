<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <div th:replace="fragments/header :: header"></div>
    <title>Schedules running in this server</title>
    <script>
        $(document).ready(function () {
            $('#schedulesTable').DataTable({
                columns: [
                    {data: "pipelineName"},
                    {data: "cron"},
                    {data: "description"},
                    {
                        data: "processId",
                        render: function (data, type, row) {
                            if (row.processId) {
                                var url = "/pipelite/ui/process?pipelineName=" + row.pipelineName + "&processId=" + row.processId;
                                return '<a href="' + url + '">' + row.processId + '</a>';
                            }
                            return '';
                        }
                    },
                    {
                        data: "startTime",
                        render: function (data) {
                            if (data) {
                                return moment(data).format('YYYY/MM/DD hh:mm:ss');
                            } else {
                                return '';
                            }
                        }
                    },
                    {
                        data: "nextTime",
                        render: function (data) {
                            if (data) {
                                return moment(data).format('YYYY/MM/DD hh:mm:ss');
                            } else {
                                return '';
                            }
                        }
                    },
                    {
                        data: "lastCompleted",
                        render: function (data) {
                            if (data) {
                                return moment(data).format('YYYY/MM/DD hh:mm:ss');
                            } else {
                                return '';
                            }
                        }
                    },
                    {
                        data: "lastFailed",
                        render: function (data) {
                            if (data) {
                                return moment(data).format('YYYY/MM/DD hh:mm:ss');
                            } else {
                                return '';
                            }
                        }
                    }
                ],
                dom: 'frtBip',
                buttons: {
                    buttons: [
                        {extend: 'copy', className: 'btn btn-outline-secondary'},
                        {extend: 'csv', className: 'btn btn-outline-secondary'},
                        {extend: 'excel', className: 'btn btn-outline-secondary'}
                    ],
                    dom: {
                        button: {
                            className: 'btn'
                        }
                    }
                },
                orderCellsTop: true,
                fixedHeader: true,
                responsive: true,
                language: {
                    "zeroRecords": " "
                },
            });

            show();
        });

        // Show the tables.
        function show() {
            var schedulesTable = $('#schedulesTable').DataTable();
            var scheduleTime = $("#scheduleTime").val();

            // Show the badge.
            $("#scheduleTimeBadge").text($("#scheduleTime option:selected").text());

            // Show the tables.

            var url = "/pipelite/schedule/";
            console.log(url);
            $.get(url, function (data, status) {
                schedulesTable.clear().rows.add(data).draw();
            });
        };

    </script>
</head>

<body>
<div th:replace="fragments/navigation :: navigation"></div>

<div class="card m-2">
    <div class="card-body">
        <h5 class="card-title">Schedules running in this server</h5>

        <table id="schedulesTable" class="table table-striped table-hover" style="width:100%">
            <thead>
            <tr>
                <th>Pipeline</th>
                <th>Cron</th>
                <th>Description</th>
                <th>Running process</th>
                <th>Start time</th>
                <th>Next time</th>
                <th>Last completed</th>
                <th>Last failed</th>
            </tr>
            </thead>
        </table>
    </div>
</div>

</body>
</html>
